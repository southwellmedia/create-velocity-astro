---
import type { HTMLAttributes } from 'astro/types';
import { cn } from '@/lib/cn';

interface Props extends HTMLAttributes<'section'> {
  /** Layout mode: centered single column or split two-column */
  layout?: 'centered' | 'split';
  /** Vertical padding size */
  size?: 'sm' | 'md' | 'lg' | 'xl';
  /** Show background grid pattern */
  showGrid?: boolean;
  /** Show decorative gradient blob */
  showBlob?: boolean;
  /** Blob position (only applies when showBlob is true) */
  blobPosition?: 'left' | 'right' | 'center';
}

const {
  layout = 'centered',
  size = 'lg',
  showGrid = false,
  showBlob = false,
  blobPosition = 'right',
  class: className,
  ...attrs
} = Astro.props;

// Check which slots are provided
const hasBadgeSlot = Astro.slots.has('badge');
const hasTitleSlot = Astro.slots.has('title');
const hasDescriptionSlot = Astro.slots.has('description');
const hasActionsSlot = Astro.slots.has('actions');
const hasAsideSlot = Astro.slots.has('aside');

// Size (padding) variants - asymmetric: more top padding for header clearance
const sizes: Record<NonNullable<Props['size']>, string> = {
  sm: 'pt-[var(--space-page-top-sm)] pb-[var(--space-section-sm)]',
  md: 'pt-[var(--space-page-top)] pb-[var(--space-section-md)]',
  lg: 'pt-[calc(var(--space-page-top)+var(--space-8))] pb-[var(--space-section-lg)]',
  xl: 'pt-[calc(var(--space-page-top)+var(--space-16))] pb-[var(--space-section-xl)]',
};

// Blob position variants
const blobPositions: Record<NonNullable<Props['blobPosition']>, string> = {
  left: '-left-20 -top-20',
  right: '-right-20 -top-20',
  center: 'left-1/2 -translate-x-1/2 -top-20',
};

// Compute alignment based on layout
const alignment = layout === 'centered' ? 'text-center items-center' : 'text-left items-start';

// Compute classes
const sectionClasses = cn(
  'relative overflow-hidden bg-background',
  sizes[size],
  className
);

const contentClasses = cn(
  'z-10 flex flex-col',
  alignment
);

const gridClasses = cn(
  'mx-auto grid max-w-6xl grid-cols-1 items-center gap-[var(--space-section-gap)] px-6',
  layout === 'split' && 'lg:grid-cols-2 lg:gap-[var(--space-section-gap)]'
);
---

<section class={sectionClasses} {...attrs}>
  {/* Background grid pattern */}
  {showGrid && (
    <div
      class="bg-grid-pattern pointer-events-none absolute inset-0 [mask-image:linear-gradient(to_bottom,white,transparent)] opacity-40"
      aria-hidden="true"
    />
  )}

  <div class={gridClasses}>
    {/* Content Column */}
    <div class={cn(contentClasses, 'order-1 lg:order-none')}>
      {/* Badge Slot */}
      {hasBadgeSlot && (
        <div class="mb-[var(--space-heading-gap)]">
          <slot name="badge" />
        </div>
      )}

      {/* Title Slot */}
      {hasTitleSlot && (
        <div class={cn(
          'mb-[var(--space-heading-gap)]',
          '[&>h1]:font-display [&>h1]:text-5xl [&>h1]:leading-[1.1] [&>h1]:font-bold [&>h1]:tracking-tight [&>h1]:text-balance [&>h1]:text-foreground md:[&>h1]:text-6xl lg:[&>h1]:text-7xl',
          '[&>h2]:font-display [&>h2]:text-4xl [&>h2]:leading-[1.1] [&>h2]:font-bold [&>h2]:tracking-tight [&>h2]:text-balance [&>h2]:text-foreground md:[&>h2]:text-5xl lg:[&>h2]:text-6xl'
        )}>
          <slot name="title" />
        </div>
      )}

      {/* Description Slot */}
      {hasDescriptionSlot && (
        <div class={cn(
          'mb-[var(--space-stack-lg)] max-w-xl text-lg leading-relaxed text-foreground-muted',
          '[&>p]:text-lg [&>p]:leading-relaxed [&>p]:text-foreground-muted',
          layout === 'centered' && 'mx-auto'
        )}>
          <slot name="description" />
        </div>
      )}

      {/* Actions Slot */}
      {hasActionsSlot && (
        <div class={cn(
          'flex w-full flex-col gap-4 sm:w-auto sm:flex-row',
          layout === 'centered' && 'justify-center'
        )}>
          <slot name="actions" />
        </div>
      )}

      {/* Default slot for additional content (social proof, etc.) */}
      <slot />
    </div>

    {/* Aside Column (for split layout) */}
    {layout === 'split' && hasAsideSlot && (
      <div class="relative z-10 w-full order-2 lg:order-none">
        <slot name="aside" />
        {/* Decorative blob for split layout */}
        {showBlob && (
          <div
            class={cn(
              'bg-brand-200/20 pointer-events-none absolute h-64 w-64 rounded-full blur-3xl',
              blobPositions[blobPosition]
            )}
            aria-hidden="true"
          />
        )}
      </div>
    )}

    {/* Decorative blob for centered layout */}
    {layout === 'centered' && showBlob && (
      <div
        class={cn(
          'bg-brand-200/20 pointer-events-none absolute h-64 w-64 rounded-full blur-3xl',
          blobPositions[blobPosition]
        )}
        aria-hidden="true"
      />
    )}
  </div>
</section>
