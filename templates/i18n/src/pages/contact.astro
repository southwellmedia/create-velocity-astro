---
/**
 * Contact Page (default locale - English)
 * URL: /contact
 */
import PageLayout from '@/layouts/PageLayout.astro';
import Icon from '@/components/ui/Icon.astro';
import Badge from '@/components/ui/Badge.astro';
import Button from '@/components/ui/Button.astro';
import Input from '@/components/ui/Input.astro';
import Textarea from '@/components/ui/Textarea.astro';
import Card from '@/components/ui/Card.astro';
import { Hero } from '@/components/hero';
import siteConfig from '@/config/site.config';
import { defaultLocale } from '@/i18n/config';
import { useTranslations } from '@/i18n/index';

const locale = defaultLocale;
const t = useTranslations(locale);
---

<PageLayout
  title={t('contact.meta.title')}
  description={t('contact.meta.description')}
  lang={locale}
  routeId="contact"
>
  <Hero layout="centered" size="sm" showGrid>
    <Badge slot="badge" pill pulse>{t('contact.hero.badge')}</Badge>

    <h1 slot="title">
      {t('contact.hero.title')} <span class="text-brand-500">{t('contact.hero.titleHighlight')}</span>
    </h1>

    <p slot="description">
      {t('contact.hero.description')}
    </p>
  </Hero>

  <!-- Contact Form Section -->
  <section class="py-20 bg-surface-secondary">
    <div class="mx-auto max-w-6xl px-6">
      <div class="grid gap-12 lg:grid-cols-2">
        <!-- Form -->
        <Card padding="lg">
          <h2 class="text-2xl font-display font-bold text-foreground mb-6">{t('contact.form.title')}</h2>

          <form id="contact-form" action="/api/contact" method="POST" class="space-y-6">
            <Input
              label={t('contact.form.name')}
              name="name"
              type="text"
              placeholder={t('contact.form.namePlaceholder')}
              required
              autocomplete="name"
            />

            <Input
              label={t('contact.form.email')}
              name="email"
              type="email"
              placeholder={t('contact.form.emailPlaceholder')}
              required
              autocomplete="email"
            />

            <Input
              label={t('contact.form.subject')}
              name="subject"
              type="text"
              placeholder={t('contact.form.subjectPlaceholder')}
            />

            <Textarea
              label={t('contact.form.message')}
              name="message"
              placeholder={t('contact.form.messagePlaceholder')}
              rows={5}
              required
            />

            <!-- Honeypot field for spam protection -->
            <div class="hidden" aria-hidden="true">
              <input type="text" name="honeypot" tabindex="-1" autocomplete="off" />
            </div>

            <div id="form-message" class="hidden text-sm"></div>

            <Button type="submit" class="w-full" id="submit-button">
              <Icon name="mail" size="sm" />
              {t('contact.form.submit')}
            </Button>
          </form>
        </Card>

        <!-- Contact Info -->
        <div class="flex flex-col justify-center">
          <h2 class="font-display text-2xl font-bold text-foreground mb-8">
            {t('contact.info.title')}
          </h2>

          <div class="space-y-6">
            <!-- Email -->
            <a href={`mailto:${siteConfig.email}`} class="block">
              <Card hover padding="sm">
                <div class="flex items-center gap-4">
                  <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-brand-500/20 to-brand-500/5 flex items-center justify-center text-brand-500 shrink-0">
                    <Icon name="mail" size="md" />
                  </div>
                  <div>
                    <p class="text-sm text-foreground-muted">{t('contact.info.email.label')}</p>
                    <p class="font-medium text-foreground">{siteConfig.email}</p>
                  </div>
                </div>
              </Card>
            </a>

            <!-- GitHub -->
            <a
              href="https://github.com/southwellmedia/velocity"
              target="_blank"
              rel="noopener noreferrer"
              class="block"
            >
              <Card hover padding="sm">
                <div class="flex items-center gap-4">
                  <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-brand-500/20 to-brand-500/5 flex items-center justify-center text-brand-500 shrink-0">
                    <Icon name="github" size="md" />
                  </div>
                  <div>
                    <p class="text-sm text-foreground-muted">{t('contact.info.github.label')}</p>
                    <p class="font-medium text-foreground">velocity</p>
                  </div>
                </div>
              </Card>
            </a>

            <!-- Twitter -->
            {siteConfig.twitter && (
              <a
                href={`https://twitter.com/${siteConfig.twitter.site.replace('@', '')}`}
                target="_blank"
                rel="noopener noreferrer"
                class="block"
              >
                <Card hover padding="sm">
                  <div class="flex items-center gap-4">
                    <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-brand-500/20 to-brand-500/5 flex items-center justify-center text-brand-500 shrink-0">
                      <Icon name="twitter" size="md" />
                    </div>
                    <div>
                      <p class="text-sm text-foreground-muted">{t('contact.info.twitter.label')}</p>
                      <p class="font-medium text-foreground">{siteConfig.twitter.site}</p>
                    </div>
                  </div>
                </Card>
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  </section>
</PageLayout>

<script>
  function initContactForm() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const button = document.getElementById('submit-button') as HTMLButtonElement;
    const message = document.getElementById('form-message') as HTMLDivElement;

    if (!form || !button || !message) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      button.disabled = true;
      button.textContent = 'Sending...';
      message.classList.add('hidden');

      try {
        const formData = new FormData(form);
        const response = await fetch('/api/contact', {
          method: 'POST',
          body: formData,
        });

        const data = await response.json();

        if (data.success) {
          message.textContent = 'Message sent successfully! We will get back to you soon.';
          message.className = 'text-sm text-success';
          form.reset();
        } else {
          const errors = data.errors ? Object.values(data.errors).flat().join(', ') : 'Something went wrong';
          message.textContent = errors;
          message.className = 'text-sm text-destructive';
        }
      } catch {
        message.textContent = 'Failed to send message. Please try again later.';
        message.className = 'text-sm text-destructive';
      } finally {
        button.disabled = false;
        button.textContent = 'Send Message';
        message.classList.remove('hidden');
      }
    });
  }

  initContactForm();
  document.addEventListener('astro:after-swap', initContactForm);
</script>
